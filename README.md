# XLSX单元格内嵌入图像提取工具 - GUI版本

这是一个带有图形用户界面(GUI)的XLSX单元格内嵌入图像提取工具。

使用情形如：
WPS Office 收集表中嵌入了图像的单元格（如用于上传图像的单元格、用于手写签名的单元格）。当收集表导出为xlsx后，此工具可用于提取这些嵌入的图像。后续可用这些提取的图像进行邮件合并等操作。用WPS打开这个xlsx时，嵌入图像的单元格会用`DISPIMG`函数显示对应的嵌入图像，比如 `=DISPIMG("ID_88D894DE092B441D8339B43876CEB428",1) `。公式中的第一个参数对应嵌入图像的内部名称，对应提取结果文件`extracted_images.xlsx`中的`图像名称`列。可以提取公式的第一个参数（比如可用公式`=REGEXP(FORMULATEXT(K2),"ID_.{32}")`提取`K2`单元格的图像内部名称），然后用xlookup在提取结果文件中查找对应的提取图像文件存放的位置。

## 功能特点

1. **用户友好的图形界面** - 使用Tkinter开发的直观界面
2. **文件选择** - 通过对话框选择XLSX文件
3. **输出目录选择** - 自定义图像输出位置
4. **选项配置** - 可选择是否创建CSV文件、Excel工作表和提取图像文件
5. **实时进度显示** - 进度条和状态标签显示当前操作
6. **详细日志输出** - 滚动文本区域显示操作日志
7. **线程安全操作** - 后台执行提取操作，界面保持响应
8. **错误处理** - 友好的错误提示和信息对话框
9. **多种输出格式** - 支持CSV和Excel两种格式的结果输出


### 1. 界面操作步骤

1. **选择XLSX文件**：
   - 点击"浏览..."按钮选择要处理的XLSX文件
   - 或直接在文本框中输入文件路径

2. **选择输出目录**：
   - 点击"浏览..."按钮选择输出目录
   - 默认输出到桌面

3. **配置选项**（可选）：
   - ☑ 创建CSV文件：生成包含图像信息的CSV文件
   - ☑ 提取图像文件：将图像文件提取到media目录

4. **开始提取**：
   - 点击"开始提取"按钮
   - 观察进度条和日志输出

5. **查看结果**：
   - 提取完成后，在输出目录查看结果
   - CSV文件：`extracted_images.csv`
   - EXCEL文件：`extracted_images.xlsx`
   - 图像文件：`media/`目录

### 3. 其他功能

- **清空日志**：点击"清空日志"按钮清除日志区域
- **退出应用**：点击"退出"按钮或关闭窗口

## 文件说明

- `extract_embbed_images_from_xlsx.exe` - GUI应用程序
- `README.md` - 本说明文档

## 技术实现

### GUI架构
- 使用Tkinter作为GUI框架
- 采用MVC-like设计模式
- 后台线程处理提取操作，避免界面冻结
- 消息队列实现线程安全的UI更新

### 核心功能
- 解析XLSX文件的`xl/cellimages.xml`
- 提取图像元数据（名称、文件路径）
- 从XLSX压缩包中提取图像文件
- 生成CSV格式的报告文件

### 错误处理
- 文件不存在验证
- 无效XLSX文件检测
- 权限错误处理
- 友好的错误提示对话框


## 注意事项

1. 仅支持包含`cellimages.xml`的XLSX文件（特定格式,如金山电子表格软件生成的带单元格内嵌入图像的XLSX文件）
2. 提取的图像文件保持原始格式（PNG、JPG等）
3. 大型文件处理可能需要较长时间，请耐心等待

## 故障排除

### 常见问题

1. ** 提取失败**：
   - 确认XLSX文件格式正确
   - 检查文件是否被其他程序占用
   - 验证输出目录是否有写入权限

2. **界面冻结**：
   - 处理大型文件时界面可能暂时无响应
   - 请等待操作完成，不要重复点击按钮

### 获取帮助

如遇到问题，请检查日志输出中的错误信息，或联系开发者。

---

**版本**: 1.0.0  
**最后更新**: 2025年12月9日  
**开发者**: xiepenguin@gmail.com
